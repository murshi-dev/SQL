--group by
--groups records based on certain function
--always use with aggregate functions - MIn,Max,Avg,Sum,Count

Select *
From product

Select AVG(P_PRICE) As AveragePrice
From Product

--display average price for each vendor
Select V_Code, AVG(P_PRICE) As AveragePrice
From Product
Group by V_Code

--display how many products each vendor has
Select V_Code, COUNT(P_CODE) As NumberOfProducts
From Product
Group by V_Code

--display the total QOH each vendor has
Select V_Code, SUM(P_QOH) As TotalQOH
From Product
Group by V_Code

--combine the above query as follows...
Select V_Code, AVG(P_PRICE) As AveragePrice,
				COUNT(P_CODE) As NumberOfProducts,
				SUM(P_QOH) As TotalQOH
From Product
Group by V_Code

--display vendor name and v code 
Select V.V_Code, V_Name, AVG(P_PRICE) As AveragePrice,
				COUNT(P_CODE) As NumberOfProducts,
				SUM(P_QOH) As TotalQOH
From Product P JOIN VENDOR V
On P.V_CODE=V.V_CODE
Group by V.V_Code,V_name

--having clause -- to filter records retrieved by 'group by' clause
--display vendor vendor name with average price greater than 10
Select V.V_Code, V_Name, AVG(P_PRICE) As AveragePrice
From Product P JOIN VENDOR V
On P.V_CODE=V.V_CODE
Group by V.V_Code,V_name
Having  AVG(P_PRICE)>10
Order by  AveragePrice

--order/sequence of instructions
Select V.V_Code, V_Name, AVG(P_PRICE) As AveragePrice --step 5 -- display columns
From Product P JOIN VENDOR V  -- step 1 --retrieves tables first
On P.V_CODE=V.V_CODE
--step 2 - where clause - filter based on the condition
Group by V.V_Code,V_name -- step 3 -- groups based on the agg function
Having  AVG(P_PRICE)>10  -- step 4 --filter again based on group by
Order by  AveragePrice -- step 6 --arrange it asc/desc

--practice
--display customer table
SELECT *
From Customer
--display how many customers in each area code
SELECT CUS_AREACODE,Count(CUS_AREACODE) As NumberOfCustomers
From Customer
Group by CUS_AREACODE

--find the total balance under each are code
SELECT CUS_AREACODE,Sum(CUS_BALANCE) As BalanceDue
From Customer
Group by CUS_AREACODE

--display many employees under each emp title
Select Emp_Title,Count(Emp_Title) As NumberOfEmployees
From Employee
Group By Emp_Title

--display the max years of experience under each emp title
Select Emp_Title,Count(Emp_Title) As NumberOfEmployees,
					Max(Emp_years) As MaximumServiceYears
From Employee
Group By Emp_Title

--display how many invoice generated by each customer
Select CUS_CODE,Count(CUS_CODE) As NumberOfInvoices
From Invoice
Group by Cus_Code

--display how many invoice generated by each customer
--also display the customer last name
Select C.CUS_CODE,Cus_Lname, Count(C.CUS_CODE) As NumberOfInvoices
From Invoice I Join Customer C
On I.CUS_CODE=C.CUS_CODE
Group by C.Cus_Code,Cus_Lname

--display the maximum price offered by each vendor
--display the vendor name also
--hint--join vendor table and product table
Select V.V_Code,V_Name,Max(P_Price) as MaximumPrice
From Vendor V Join Product P
On V.V_CODE=P.V_CODE
Group By V.V_Code, V_Name